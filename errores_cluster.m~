% Definimos una funcion de los errores cluster, escalado por como lo
% sugiere el Hansen

function [var_cluster, ee_cluster] = errores_cluster(N, K, G, X, e_cluster)

% Calculamos primero los errores al cuadrado
e_gorro2 = e_gorro.^2;
% Primero, calculamos la matriz de los errores para el caso de cluster 
omega = X' * (e_cluster * e_cluster') * X;

% Calculamos ahora el parametro que escala la varianza
A = ((N - 1)/(N - K)) * ((G)/(G - 1));

% Ahora, definimos la matriz de varianza y covarianza robusta y escalada
% por N y K
var_cluster = A *((X' * X)^(-1)) * X' * omega * X * ((X' * X)^(-1));

% Finalmente, los errores robustos son la raiz de la diagonal de lo anterior
ee_cluster = sqrt(diag(var_cluster));
end